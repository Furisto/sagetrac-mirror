#!/usr/bin/env bash

########################################################################
# Regenerate auto-generated files, using information in SAGE_ROOT/build/
#
# This script is run by SAGE_ROOT/bootstrap as part of the bootstrapping phase
# (before configure, before creating source distributions).
########################################################################

set -e

if [ -z "$SAGE_ROOT" ]; then
    echo Please run the top-level bootstrap script of the Sage distribution.
    exit 1
fi

cd "$SAGE_ROOT"

# https://pip.pypa.io/en/stable/reference/pip_install/#requirements-file-format
echo >&2 $0:$LINENO: installing src/requirements.txt, src/constraints.txt, src/install-requires.txt
(cd src && for list in requirements.txt constraints.txt install-requires.txt; do
     (echo "# Automatically generated by ../bootstrap; do not edit"
      echo "#"
      for filename in $(find ../build/pkgs -type f -name sagelib-$list); do
          echo "# From $filename:"
          cat $filename
          echo ""
      done) > $list
done)

src/doc/bootstrap
