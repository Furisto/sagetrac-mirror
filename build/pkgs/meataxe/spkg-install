cd src

# This is the place where arithmetic tables and some other input files are
# searched by default.
export MTXLIB="$DOT_SAGE"/meataxe

# Directory where executables are installed.
export MTXBIN="$SAGE_LOCAL"/bin

# Field size up to GF(256)
export ZZZ=0

# In principle, one should uncomment for field sizes up to GF(2^16).
# But upstream doesn't provide the required sources.
#export ZZZ=1

# We create a directory for the multiplication tables
mkdir -p $MTXLIB

# We delete a static meataxe library that might be leftover
# from installation of MeatAxe (as opposed to SharedMeatAxe).
rm -f "$SAGE_LOCAL"/lib/libmtx.a

if [ $? -ne 0 ]; then
    echo >&2 "Error creating directory for multiplication tables."
    exit 1
fi

./configure --prefix="$SAGE_LOCAL"
if [ $? -ne 0 ]; then
    echo >&2 "Error configuring SharedMeatAxe."
    exit 1
fi

$MAKE
if [ $? -ne 0 ]; then
    echo >&2 "Error building SharedMeatAxe."
    exit 1
fi

$MAKE install
if [ $? -ne 0 ]; then
    echo >&2 "Error installing SharedMeatAxe."
    exit 1
fi

if [ "x$SAGE_SPKG_INSTALL_DOCS" = xyes ] ; then
    $MAKE doc
if [ $? -ne 0 ]; then
    echo >&2 "Error documenting SharedMeatAxe."
    exit 1
fi
fi

